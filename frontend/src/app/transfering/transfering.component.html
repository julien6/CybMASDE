<div class="section">
  <h3>Transferring Configuration</h3>

  <mat-expansion-panel expanded="true">
    <mat-expansion-panel-header>
      <mat-panel-title>Deployment and Data Transfer Settings</mat-panel-title>
      <mat-panel-description>
        Configure how CybMASDE interacts with the target environment
      </mat-panel-description>
    </mat-expansion-panel-header>

    <!-- DEPLOY MODE -->
    <div class="field-row">
      <mat-form-field appearance="outline" class="medium-field">
        <mat-label>Deploy Mode</mat-label>
        <mat-select [(ngModel)]="transferring.configuration.deploy_mode"
          (selectionChange)="onValueChange('deploy_mode', $event.value)">
          <mat-option value="DIRECT">Direct (policy embedded in agents)</mat-option>
          <mat-option value="REMOTE">Remote (policy executed via CybMASDE)</mat-option>
        </mat-select>
      </mat-form-field>
      <button mat-icon-button matTooltip="Select how the learned policy is deployed:
          - DIRECT: policy runs on agents.
          - REMOTE: CybMASDE runs the policy and sends actions to agents.">
        <mat-icon>help</mat-icon>
      </button>
    </div>

    <!-- ENVIRONMENT API -->
    <div class="field-row">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Environment API</mat-label>
        <input matInput [(ngModel)]="transferring.configuration.environment_api"
          (ngModelChange)="onValueChange('environment_api', $event)" />
      </mat-form-field>
      <button mat-icon-button
        matTooltip="Python file exposing the API used by CybMASDE to communicate with the real environment">
        <mat-icon>help</mat-icon>
      </button>
      <button mat-raised-button color="primary" (click)="onFileSelected('environment_api')">
        Choose File
      </button>
    </div>

    <!-- MAX NUMBER OF ITERATIONS -->
    <div class="field-row">
      <mat-form-field appearance="outline" class="small-field">
        <mat-label>Max Iterations</mat-label>
        <input matInput type="number" min="1" [(ngModel)]="transferring.configuration.max_nb_iteration"
          (ngModelChange)="onValueChange('max_nb_iteration', $event)" />
      </mat-form-field>
      <button mat-icon-button matTooltip="Maximum number of iterations before stopping the transferring process">
        <mat-icon>help</mat-icon>
      </button>
    </div>

    <!-- TRAJECTORY BATCH SIZE -->
    <div class="field-row">
      <mat-form-field appearance="outline" class="small-field">
        <mat-label>Trajectory Batch Size</mat-label>
        <input matInput type="number" min="1" [(ngModel)]="transferring.configuration.trajectory_batch_size"
          (ngModelChange)="onValueChange('trajectory_batch_size', $event)" />
      </mat-form-field>
      <button mat-icon-button matTooltip="Number of trajectories collected from deployed agents in each batch">
        <mat-icon>help</mat-icon>
      </button>
    </div>

    <!-- TRAJECTORY RETRIEVE FREQUENCY -->
    <div class="field-row">
      <mat-form-field appearance="outline" class="small-field">
        <mat-label>Trajectory Retrieve Frequency</mat-label>
        <input matInput type="number" min="1" [(ngModel)]="transferring.configuration.trajectory_retrieve_frequency"
          (ngModelChange)="onValueChange('trajectory_retrieve_frequency', $event)" />
      </mat-form-field>
      <button mat-icon-button matTooltip="Frequency (in cycles) of retrieving new trajectories from deployed agents">
        <mat-icon>help</mat-icon>
      </button>
    </div>
  </mat-expansion-panel>
</div>