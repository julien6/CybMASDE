<div class="section">
  <h3>Modeling Configuration</h3>

  <!-- ============================== -->
  <!-- 1. Environment Path -->
  <!-- ============================== -->
  <mat-expansion-panel>
    <mat-expansion-panel-header>
      <mat-panel-title>Environment</mat-panel-title>
      <mat-panel-description>Custom environment definition</mat-panel-description>
    </mat-expansion-panel-header>

    <div class="field-row">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Environment Path</mat-label>
        <input matInput [(ngModel)]="model.environment_path" />
      </mat-form-field>

      <button mat-icon-button matTooltip="Python file implementing CustomParallelEnv">
        <mat-icon>help</mat-icon>
      </button>

      <button mat-raised-button color="primary" (click)="onFileSelected('environment_path')">
        Choose a file
      </button>
    </div>
  </mat-expansion-panel>

  <!-- ============================== -->
  <!-- 2. Generated Environment -->
  <!-- ============================== -->
  <mat-expansion-panel>
    <mat-expansion-panel-header>
      <mat-panel-title>Generated Environment</mat-panel-title>
      <mat-panel-description>World model and component functions</mat-panel-description>
    </mat-expansion-panel-header>

    <!-- ================================= -->
    <!-- 2.1 World Model -->
    <!-- ================================= -->
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>World Model</mat-panel-title>
      </mat-expansion-panel-header>

      <!-- ================================= -->
      <!-- 2.1.1 JOPM -->
      <!-- ================================= -->
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>Joint Observation Prediction Model (JOPM)</mat-panel-title>
        </mat-expansion-panel-header>

        <!-- AUTOENCODER -->
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>Autoencoder</mat-panel-title>
          </mat-expansion-panel-header>

          <div class="field-row">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Model Path</mat-label>
              <input matInput [(ngModel)]="model.generated_environment.world_model.jopm.autoencoder.model" />
            </mat-form-field>
            <button mat-icon-button matTooltip="Path to the trained autoencoder model directory">
              <mat-icon>help</mat-icon>
            </button>
            <button mat-raised-button color="primary"
              (click)="onFileSelected('generated_environment.world_model.jopm.autoencoder.model')">
              Choose a file
            </button>
          </div>

          <div class="field-row">
            <label>Hyperparameters JSON</label>
            <button mat-icon-button matTooltip="Hyperparameters for the autoencoder training">
              <mat-icon>help</mat-icon>
            </button>
            <button mat-raised-button color="primary"
              (click)="openFileContent('generated_environment.world_model.jopm.autoencoder.hyperparameters', 'autoencoder')">
              Load JSON file
            </button>
          </div>

          <ngx-monaco-editor [options]="jsonEditorOptions" [ngModel]="this.autoencoderJson" (ngModelChange)="
              this.autoencoderJson = $event
            ">
          </ngx-monaco-editor>

          <div class="field-row">
            <mat-form-field appearance="outline" class="small-field">
              <mat-label>Max MSE</mat-label>
              <input matInput type="number"
                [(ngModel)]="model.generated_environment.world_model.jopm.autoencoder.max_mean_square_error" />
            </mat-form-field>
            <button mat-icon-button matTooltip="Maximum allowed mean square error for training">
              <mat-icon>help</mat-icon>
            </button>
          </div>
        </mat-expansion-panel>

        <!-- RDLM -->
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>Recurrent Dynamics Latent Model (RDLM)</mat-panel-title>
          </mat-expansion-panel-header>

          <div class="field-row">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Model Path</mat-label>
              <input matInput [(ngModel)]="model.generated_environment.world_model.jopm.rdlm.model" />
            </mat-form-field>
            <button mat-icon-button matTooltip="Path to the trained RDLM model directory">
              <mat-icon>help</mat-icon>
            </button>
            <button mat-raised-button color="primary"
              (click)="onFileSelected('generated_environment.world_model.jopm.rdlm.model')">
              Choose a file
            </button>
          </div>

          <div class="field-row">
            <label>Hyperparameters JSON</label>
            <button mat-icon-button matTooltip="Hyperparameters for the RDLM training">
              <mat-icon>help</mat-icon>
            </button>
            <button mat-raised-button color="primary"
              (click)="openFileContent('generated_environment.world_model.jopm.rdlm.hyperparameters', 'rdlm')">
              Load JSON file
            </button>
          </div>

          <ngx-monaco-editor [options]="jsonEditorOptions" [ngModel]="this.rdlmJson" (ngModelChange)="
              this.rdlmJson = $event
            ">
          </ngx-monaco-editor>

          <div class="field-row">
            <mat-form-field appearance="outline" class="small-field">
              <mat-label>Max MSE</mat-label>
              <input matInput type="number"
                [(ngModel)]="model.generated_environment.world_model.jopm.rdlm.max_mean_square_error" />
            </mat-form-field>
            <button mat-icon-button matTooltip="Maximum allowed mean square error for training">
              <mat-icon>help</mat-icon>
            </button>
          </div>
        </mat-expansion-panel>

        <!-- Initial Observations -->
        <div class="field-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Initial Joint Observations</mat-label>
            <input matInput [(ngModel)]="model.generated_environment.world_model.jopm.initial_joint_observations" />
          </mat-form-field>
          <button mat-icon-button matTooltip="File containing initial joint observations">
            <mat-icon>help</mat-icon>
          </button>
          <button mat-raised-button color="primary"
            (click)="onFileSelected('generated_environment.world_model.jopm.initial_joint_observations')">
            Choose a file
          </button>
        </div>
      </mat-expansion-panel>

      <!-- WORLD MODEL METADATA -->
      <div class="field-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Used Traces Path</mat-label>
          <input matInput [(ngModel)]="model.generated_environment.world_model.used_traces_path" />
        </mat-form-field>
        <button mat-icon-button matTooltip="Directory containing traces used for training the world model">
          <mat-icon>help</mat-icon>
        </button>
      </div>
    </mat-expansion-panel>

    <!-- ================================= -->
    <!-- 2.2 Component Functions -->
    <!-- ================================= -->
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>Component Functions</mat-panel-title>
      </mat-expansion-panel-header>

      <div class="field-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Component Functions Path</mat-label>
          <input matInput [(ngModel)]="model.generated_environment.component_functions_path" />
        </mat-form-field>
        <button mat-icon-button matTooltip="Python file containing ComponentFunctions class">
          <mat-icon>help</mat-icon>
        </button>
        <button mat-raised-button color="primary"
          (click)="onFileSelected('generated_environment.component_functions_path')">
          Choose a file
        </button>
      </div>
    </mat-expansion-panel>
  </mat-expansion-panel>
</div>